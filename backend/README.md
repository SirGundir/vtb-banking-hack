## –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç

### –≠–Ω–≤—Å—ã:

- `postgres/.env`
```
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_HOST=vtb_banking.postgres
POSTGRES_PORT=5432
POSTGRES_DATABASE=postgres
```

- user_api/.env
```
REDIS_PORT=6379
REDIS_HOST=vtb_banking.redis
SECRET_KEY='wow so secret'
```

### –ó–∞–ø—É—Å–∫:
```
make down ; make build ; make up
# –ü–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ –∑–∞–∏–Ω–∏—Ç–∏—Ç—å –ë–î
make head
```

–ó–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ 4000 –ø–æ—Ä—Ç—É.

### –í—ã–≥—Ä—É–∑–∏—Ç—å API –¥–æ–∫—É:
```
make user_api_docs
```

# üìò ClickHouse –¢–∞–±–ª–∏—Ü—ã

---

## üßæ `accounts` ‚Äî –°—á–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
–•—Ä–∞–Ω–∏—Ç –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö —Å—á–µ—Ç–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|------|-----------|
| `user_id` | `UUID` | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. |
| `bank_id` | `Int64` | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–∞–Ω–∫–∞, –≤ –∫–æ—Ç–æ—Ä–æ–º –æ—Ç–∫—Ä—ã—Ç —Å—á—ë—Ç. |
| `account_id` | `String` | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ —Å—á—ë—Ç–∞. |
| `status` | `String` | –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å —Å—á—ë—Ç–∞. |
| `currency` | `String` | –í–∞–ª—é—Ç–∞ —Å—á—ë—Ç–∞. |
| `account_type` | `String` | –¢–∏–ø —Å—á—ë—Ç–∞. |
| `account_sub_type` | `String` | –ü–æ–¥—Ç–∏–ø —Å—á—ë—Ç–∞. |
| `opening_date` | `Date` | –î–∞—Ç–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —Å—á—ë—Ç–∞. |

**–î–≤–∏–∂–æ–∫:** `ReplacingMergeTree()`  
**ORDER BY:** `(user_id, bank_id, account_id)`

---

## üí∞ `account_balances` ‚Äî –ë–∞–ª–∞–Ω—Å—ã –ø–æ —Å—á–µ—Ç–∞–º
–°–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–∏—Ö –∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –±–∞–ª–∞–Ω—Å–∞—Ö –ø–æ –∫–∞–∂–¥–æ–º—É —Å—á—ë—Ç—É.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|------|-----------|
| `user_id` | `UUID` | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. |
| `bank_id` | `Int64` | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–∞–Ω–∫–∞. |
| `account_id` | `String` | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å—á—ë—Ç–∞. |
| `currency` | `String` | –í–∞–ª—é—Ç–∞ –±–∞–ª–∞–Ω—Å–∞. |
| `amount` | `Decimal64(2)` | –°—É–º–º–∞ –±–∞–ª–∞–Ω—Å–∞. |
| `balance_type` | `String` | –¢–∏–ø –±–∞–ª–∞–Ω—Å–∞. |
| `credit_debit_indicator` | `String` | –ü—Ä–∏–∑–Ω–∞–∫ –∫—Ä–µ–¥–∏—Ç/–¥–µ–±–µ—Ç. |
| `balance_at_datetime` | `DateTime` | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –±–∞–ª–∞–Ω—Å–∞. |

**–î–≤–∏–∂–æ–∫:** `ReplacingMergeTree()`  
**ORDER BY:** `(user_id, bank_id, account_id, balance_at_datetime)`

---

## üí≥ `transactions` ‚Äî –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ —Å—á–µ—Ç–∞–º
–•—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –æ –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|------|-----------|
| `user_id` | `UUID` | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. |
| `bank_id` | `Int64` | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–∞–Ω–∫–∞. |
| `account_id` | `String` | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å—á—ë—Ç–∞. |
| `transaction_id` | `String` | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. |
| `status` | `String` | –°—Ç–∞—Ç—É—Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. |
| `transaction_info` | `String` | –û–ø–∏—Å–∞–Ω–∏–µ –∏–ª–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞. |
| `currency` | `String` | –í–∞–ª—é—Ç–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. |
| `amount` | `Decimal64(2)` | –°—É–º–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. |
| `bank_transaction_code` | `String` | –ö–æ–¥ —Ç–∏–ø–∞ –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏. |
| `booking_dt` | `DateTime` | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏. |
| `value_dt` | `DateTime` | –î–∞—Ç–∞ –≤–∞–ª—é—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏. |

**–î–≤–∏–∂–æ–∫:** `ReplacingMergeTree()`  
**ORDER BY:** `(user_id, bank_id, account_id, transaction_id)`

---

## üè¶ `bank_products` ‚Äî –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã
–°–æ–¥–µ—Ä–∂–∏—Ç —Å–ø—Ä–∞–≤–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–¥—É–∫—Ç–∞—Ö, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã—Ö –±–∞–Ω–∫–∞–º–∏.

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|------|-----------|
| `bank_id` | `Int64` | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–∞–Ω–∫–∞. |
| `product_id` | `String` | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–¥—É–∫—Ç–∞. |
| `product_type` | `String` | –¢–∏–ø –ø—Ä–æ–¥—É–∫—Ç–∞. |
| `product_name` | `String` | –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞. |
| `description` | `Nullable(String)` | –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞. |
| `interest_rate` | `Nullable(Decimal64(2))` | –ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞. |
| `min_amount` | `Nullable(Decimal64(2))` | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞. |
| `max_amount` | `Nullable(Decimal64(2))` | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞. |
| `term_months` | `Nullable(Int64)` | –°—Ä–æ–∫ –≤ –º–µ—Å—è—Ü–∞—Ö. |

**–î–≤–∏–∂–æ–∫:** `ReplacingMergeTree()`  
**ORDER BY:** `(bank_id, product_id)`
